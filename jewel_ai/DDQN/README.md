# 📌 Project Overview
https://youtu.be/uMm5tCExLoE
本專題使用 **Double Deep Q-Network (DDQN)** 訓練一款自製的 **三消遊戲（Match-3 Game）**。  
遊戲具有 **重力、隨機插入寶石、牆壁生成、游標移動、交換寶石** 等特殊規則，比一般 match-3 更複雜。

強化學習的目標是在有限步數內最大化消除寶石的數量並延長遊戲，不讓畫面因為牆壁堆滿而死亡。

---

# 🎮 Game Environment

## 🧩 Board Specification

- 棋盤大小：**9 × 6**
- 共有 **8 個 one-hot 通道** → shape = **(9, 6, 8)**

### Layer 含義

| Layer Index | Meaning |
|-------------|----------|
| 0 | 寶石 1 |
| 1 | 寶石 2 |
| 2 | 寶石 3 |
| 3 | 寶石 4 |
| 4 | 寶石 5 |
| 5 | 寶石 6 |
| 6 | 寶石 7 |
| 7 | 牆壁 |
| 8 | 游標位置 |

> 💡 **補充**  
> 雖然原本定義 9×6×8，但實際上還多一層游標資訊，可依需求調整為 **9×6×9**。

---

## 🎮 Actions (動作空間)

總共 **6 個動作**：

| Action ID | Description |
|-----------|-------------|
| 0 | 無動作 (No-op) |
| 1 | 游標上移 |
| 2 | 游標下移 |
| 3 | 游標左移 |
| 4 | 游標右移 |
| 5 | 點擊（與右邊寶石互換） |

---

# 🧱 Special Rules

## 🔹 初始狀態  
遊戲一開始會生成 **3 行不可消除的寶石**（random but fixed）。

## 🔹 游標移動  
透過上下左右移動游標，移到指定位置後可選擇點擊。

## 🔹 點擊交換寶石  

當執行 `action = 5` 時：

- ✔ 交換 **當前位置** 與 **右邊位置** 的寶石  
- ❗ **注意：只能與右邊交換（遊戲規則自定）**

---

# 🔍 消除判定

交換成功後若形成以下任一狀況會觸發消除：

- 3 連線  
- 4 連線  
- 5 連線  
- L 型  
- T 型  

並會進一步觸發 **重力掉落**。

---

# 🧲 重力系統

任何空格都會使該列上方的寶石自動往下掉落直到填滿。

---

# 📥 插入新行 (Row Insertion)

遊戲中有兩種插入方式：

1. **環境固定每 X 步自動插入一行隨機寶石**  
2. **玩家主動插入一行新寶石**

插入的行會將整個棋盤往上推，使遊戲難度提升。

---

# 🧱 牆壁系統 (Wall Mechanism)

- 當步數達到一定條件後，環境會**隨機產生一組牆壁**  
- 牆壁的 one-hot code = **7**  
- 牆壁會以 **一整組（連續多格且一次一排）** 生成  
- 牆壁 **無法被三消直接消除**

### ✔ 牆壁的正確消除方式  
必須消除 **牆壁相鄰的寶石**  
→ 相鄰寶石被消除後，牆壁會 **轉變成隨機寶石**

### ⚠ 如果牆壁被推到最頂端？
- 若牆壁到達最上層，遊戲將 **無法再插入新行**  
- 玩家需要優先處理牆壁，不然很容易 **Game Over**
